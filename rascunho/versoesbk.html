<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@600&display=swap" rel="stylesheet">
    <title>Bíblia Sagrada Online</title>
    <!-- Link para o arquivo CSS comum -->
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header>
        <div class="header-top">
            <!-- O Título H1 será atualizado pelo script de inicialização abaixo -->
            <h1 id="titulo-principal-versao">Bíblia Sagrada</h1>
            <div class="search-bar">
                <!-- O select de versão aqui pode ser usado para obter a lista de versoes validas, mesmo escondido -->
                <select id="seletor-versao-principal" style="display: none;">
                    <option value="arc">ARC</option>
                    <option value="ara">ARA</option>
                    <option value="nvi">NVI</option>
                    <option value="acf">ACF</option>
                    <option value="ntlh">NTLH</option>
                    <option value="kjv">KJV</option>
                    <option value="naa">NAA</option>
                    <option value="original">ORIGINAL</option>
                </select>
                <input type="text" placeholder="Digite o termo de busca">
                <button>Buscar</button>
            </div>
        </div>
        <div class="header-bottom">
            <nav>
                <ul>
                    <li><a href="#" id="link-slide">Slide</a></li>
                    <!-- Link para voltar ao Menu Inicial (index.html) -->
                    <li><a href="../index.html">Menu</a></li>
                    <!-- Outros itens do dropdown permanecem -->
                    <li class="dropdown">
                        <a href="#" id="dicionario">Dicionário e Concordância</a>
                        <ul class="dropdown-content" id="dicionario-list"></ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" id="harpa-hinario">Harpa e Hinário</a>
                        <ul class="dropdown-content" id="harpa-hinario-list"></ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" id="baixar">Baixar</a>
                        <ul class="dropdown-content" id="baixar-list"></ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" id="utilidades">Utilidades</a>
                        <ul class="dropdown-content" id="utilidades-list"></ul>
                    </li>
                    <li><a href="mailto:wagnerffreitas1973@gmail.com">Contato</a></li>
                    <li><a href="#" id="sobre">Sobre</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        <div class="container">
            <aside class="menu-livros">
                <h3>LIVROS</h3>
                <ul>
                    <li><a href="#" data-livro="genesis">Gênesis</a></li>
                    <li><a href="#" data-livro="exodo">Êxodo</a></li>
                    <li><a href="#" data-livro="levitico">Levítico</a></li>
                    <li><a href="#" data-livro="numeros">Números</a></li>
                    <li><a href="#" data-livro="deuteronomio">Deuteronômio</a></li>
                    <li><a href="#" data-livro="josue">Josué</a></li>
                    <li><a href="#" data-livro="juizes">Juízes</a></li>
                    <li><a href="#" data-livro="rute">Rute</a></li>
                    <li><a href="#" data-livro="1samuel">1º Samuel</a></li>
                    <li><a href="#" data-livro="2samuel">2º Samuel</a></li>
                    <li><a href="#" data-livro="1reis">1º Reis</a></li>
                    <li><a href="#" data-livro="2reis">2º Reis</a></li>
                    <li><a href="#" data-livro="1cronicas">1º Crônicas</a></li>
                    <li><a href="#" data-livro="2cronicas">2º Crônicas</a></li>
                    <li><a href="#" data-livro="esdras">Esdras</a></li>
                    <li><a href="#" data-livro="neemias">Neemias</a></li>
                    <li><a href="#" data-livro="ester">Ester</a></li>
                    <li><a href="#" data-livro="jo">Jó</a></li>
                    <li><a href="#" data-livro="salmos">Salmos</a></li>
                    <li><a href="#" data-livro="proverbios">Provérbios</a></li>
                    <li><a href="#" data-livro="eclesiastes">Eclesiastes</a></li>
                    <li><a href="#" data-livro="cantares">Cantares</a></li>
                    <li><a href="#" data-livro="isaias">Isaías</a></li>
                    <li><a href="#" data-livro="jeremias">Jeremias</a></li>
                    <li><a href="#" data-livro="lamentacoes">Lamentações</a></li>
                    <li><a href="#" data-livro="ezequiel">Ezequiel</a></li>
                    <li><a href="#" data-livro="daniel">Daniel</a></li>
                    <li><a href="#" data-livro="oseias">Oseias</a></li>
                    <li><a href="#" data-livro="joel">Joel</a></li>
                    <li><a href="#" data-livro="amos">Amós</a></li>
                    <li><a href="#" data-livro="obadias">Obadias</a></li>
                    <li><a href="#" data-livro="jonas">Jonas</a></li>
                    <li><a href="#" data-livro="miqueias">Miqueias</a></li>
                    <li><a href="#" data-livro="naum">Naum</a></li>
                    <li><a href="#" data-livro="habacuque">Habacuque</a></li>
                    <li><a href="#" data-livro="sofonias">Sofonias</a></li>
                    <li><a href="#" data-livro="ageu">Ageu</a></li>
                    <li><a href="#" data-livro="zacarias">Zacarias</a></li>
                    <li><a href="#" data-livro="malaquias">Malaquias</a></li>
                    <li><a href="#" data-livro="mateus">Mateus</a></li>
                    <li><a href="#" data-livro="marcos">Marcos</a></li>
                    <li><a href="#" data-livro="lucas">Lucas</a></li>
                    <li><a href="#" data-livro="joao">João</a></li>
                    <li><a href="#" data-livro="atos">Atos</a></li>
                    <li><a href="#" data-livro="romanos">Romanos</a></li>
                    <li><a href="#" data-livro="1corintios">1º Coríntios</a></li>
                    <li><a href="#" data-livro="2corintios">2º Coríntios</a></li>
                    <li><a href="#" data-livro="galatas">Gálatas</a></li>
                    <li><a href="#" data-livro="efesios">Efésios</a></li>
                    <li><a href="#" data-livro="filipenses">Filipenses</a></li>
                    <li><a href="#" data-livro="colossenses">Colossenses</a></li>
                    <li><a href="#" data-livro="1tessalonicenses">1º Tessalonicenses</a></li>
                    <li><a href="#" data-livro="2tessalonicenses">2º Tessalonicenses</a></li>
                    <li><a href="#" data-livro="1timoteo">1º Timóteo</a></li>
                    <li><a href="#" data-livro="2timoteo">2º Timóteo</a></li>
                    <li><a href="#" data-livro="tito">Tito</a></li>
                    <li><a href="#" data-livro="filemom">Filemom</a></li>
                    <li><a href="#" data-livro="hebreus">Hebreus</a></li>
                    <li><a href="#" data-livro="tiago">Tiago</a></li>
                    <li><a href="#" data-livro="1pedro">1º Pedro</a></li>
                    <li><a href="#" data-livro="2pedro">2º Pedro</a></li>
                    <li><a href="#" data-livro="1joao">1º João</a></li>
                    <li><a href="#" data-livro="2joao">2º João</a></li>
                    <li><a href="#" data-livro="3joao">3º João</a></li>
                    <li><a href="#" data-livro="judas">Judas</a></li>
                    <li><a href="#" data-livro="apocalipse">Apocalipse</a></li>
                </ul>
            </aside>
            <section class="content">
                <h2></h2> <!-- Título dinâmico (será preenchido pelo JS) -->
                <div class="watermark">
                    <!-- A imagem é adicionada/controlada por watermarker.js -->
                </div>
            </section>
        </div>
    </main>
    <footer>
        <p>© Bíblia Sagrada 2024</p>
    </footer>

    <!-- Scripts Comuns (Carregados Estaticamente) -->
    <script src="../script/watermarker.js"></script>
    <script src="../script/sobre.js"></script> <!-- Define window.inicializarSobre -->
    <script src="../script/dropdown.js"></script> <!-- Define window.inicializarDropdowns -->
    <script src="../script/biblia-navegacao.js"></script> <!-- Define funções de navegação e chama inicializações -->
    <!-- Scripts da versão específica e do slide serão carregados dinamicamente abaixo -->

    <!-- Script de Inicialização para carregar a versão correta e o slide.js -->
    <script>
        (function() { // IIFE para encapsular o escopo
            'use strict';

            // Função para obter parâmetro da URL
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            // Função para carregar script dinamicamente e retornar uma Promise
            function loadScriptAsync(src, id) {
                return new Promise((resolve, reject) => {
                    const oldScript = document.getElementById(id);
                    if (oldScript) oldScript.remove(); // Remove script anterior com o mesmo ID

                    const script = document.createElement('script');
                    script.src = src;
                    script.id = id;
                    script.async = false; // Garante execução mais sequencial se necessário (embora onload seja melhor)
                    script.onload = () => {
                        console.log(`Script carregado com sucesso: ${src}`);
                        resolve(); // Resolve a promise quando carregar
                    };
                    script.onerror = (event) => {
                        console.error(`Falha ao carregar o script: ${src}`, event);
                        reject(new Error(`Falha ao carregar ${src}`));
                    };
                    document.body.appendChild(script); // Adiciona ao final do body
                });
            }

            // Função para inicializar a versão
            async function inicializarVersao(versaoCod) {
                console.log(`[Principal] Inicializando versão: ${versaoCod.toUpperCase()}`);
                const tituloPrincipalEl = document.getElementById('titulo-principal-versao');
                if (tituloPrincipalEl) {
                    tituloPrincipalEl.textContent = `Bíblia Sagrada ${versaoCod.toUpperCase()}`;
                }

                // Adiciona classe ao body para CSS específico da versão (opcional)
                document.body.className = ''; // Limpa classes anteriores
                const versoesHtml = ['arc']; // Adicione outras versões baseadas em HTML aqui
                if (versoesHtml.includes(versaoCod)) {
                    document.body.classList.add('versao-html-ativa');
                } else {
                    document.body.classList.add('versao-json-ativa');
                }

                try {
                    // Caminho relativo a partir de html/versoes.html para a pasta script/
                    const basePath = '../script/';

                    // 1. Carrega o script da versão específica (ex: ../script/arc.js)
                    await loadScriptAsync(`${basePath}${versaoCod}.js`, 'script-versao-biblica');

                    // 2. APÓS o script da versão ter carregado, carrega o slide.js
                    await loadScriptAsync(`${basePath}slide.js`, 'script-slide');

                    // 3. Chama as funções de inicialização dos módulos que dependem do DOM
                    //    Estas funções devem ter sido definidas nos scripts carregados estaticamente
                    //    e anexadas ao objeto window.
                    if (typeof window.inicializarDropdowns === 'function') {
                        window.inicializarDropdowns();
                    } else {
                        console.error("Função inicializarDropdowns não encontrada.");
                    }
                    if (typeof window.inicializarSobre === 'function') {
                        window.inicializarSobre();
                    } else {
                         console.error("Função inicializarSobre não encontrada.");
                    }
                    if (typeof window.inicializarSlide === 'function') {
                        // Esta função (dentro de slide.js) adiciona o listener ao link #link-slide
                        window.inicializarSlide();
                    } else {
                         console.error("Função inicializarSlide não encontrada.");
                    }


                    // 4. (Opcional) Limpa conteúdo e carrega um livro padrão
                    const contentArea = document.querySelector('.content');
                    if (contentArea) {
                        const h2 = contentArea.querySelector('h2');
                        if(h2) h2.textContent = '';
                        contentArea.querySelectorAll('.book-content, .versiculo-texto, .capitulos-container, .versiculos-content').forEach(el => el.remove());
                    }
                    if (typeof window.loadBook === 'function') { // loadBook está em biblia-navegacao.js
                        const primeiroLivroLink = document.querySelector('.menu-livros a');
                        const livroPadrao = primeiroLivroLink ? primeiroLivroLink.dataset.livro : 'genesis';
                        // window.loadBook(livroPadrao); // Descomente para carregar Gênesis (ou o primeiro livro) por padrão
                        console.log(`[Principal] Versão ${versaoCod.toUpperCase()} inicializada. Interface pronta.`);
                    } else {
                        console.error("[Principal] Função window.loadBook (de biblia-navegacao.js) não encontrada.");
                    }

                } catch (error) {
                    console.error(`[Principal] Erro crítico ao inicializar a versão ${versaoCod.toUpperCase()}:`, error);
                    alert(`Erro ao inicializar a versão ${versaoCod.toUpperCase()}. Verifique o console.`);
                     const contentArea = document.querySelector('.content');
                     if (contentArea) {
                         contentArea.innerHTML = `<h2>Erro ao carregar versão ${versaoCod.toUpperCase()}</h2><p>${error.message}. Verifique o console para detalhes.</p>`;
                     }
                }
            }

            // Executa a inicialização quando o DOM estiver pronto
            document.addEventListener('DOMContentLoaded', () => {
                console.log("[Principal] DOMContentLoaded disparado.");
                const seletorVersao = document.getElementById('seletor-versao-principal');

                // Garante que o seletor exista antes de acessá-lo
                let versaoPadraoSelect = 'arc'; // Padrão absoluto
                let opcoesValidas = ['arc', 'ara', 'nvi', 'acf', 'ntlh', 'kjv', 'naa', 'original']; // Lista padrão
                if (seletorVersao) {
                     opcoesValidas = Array.from(seletorVersao.options).map(opt => opt.value);
                     versaoPadraoSelect = seletorVersao.value || opcoesValidas[0] || 'arc'; // Pega o valor selecionado ou o primeiro ou 'arc'
                 } else {
                     console.warn("Elemento <select id='seletor-versao-principal'> não encontrado.");
                 }


                const versaoSalva = localStorage.getItem('versaoBiblicaSelecionada');
                let versaoInicial = getQueryParam('version') || versaoSalva || versaoPadraoSelect;

                // Valida se a versão inicial é uma das opções válidas
                if (!opcoesValidas.includes(versaoInicial)) {
                    console.warn(`[Principal] Versão inicial inválida ('${versaoInicial}'), usando '${opcoesValidas[0] || 'arc'}' como padrão.`);
                    versaoInicial = opcoesValidas[0] || 'arc';
                }

                if (seletorVersao) { // Atualiza o select se ele existir
                    seletorVersao.value = versaoInicial;
                }
                localStorage.setItem('versaoBiblicaSelecionada', versaoInicial);

                // Inicia o carregamento da versão detectada
                inicializarVersao(versaoInicial);

                // Adiciona listener ao select (se existir) para recarregar a página ao mudar
                if (seletorVersao) {
                    seletorVersao.addEventListener('change', (event) => {
                        const novaVersao = event.target.value;
                        localStorage.setItem('versaoBiblicaSelecionada', novaVersao);
                        // Recarrega a página com o novo parâmetro de versão
                        window.location.search = `?version=${novaVersao}`;
                    });
                }

                // Preenche o dropdown de versões (se ele existir) com links para recarregar
                const versoesDropdownList = document.getElementById('versoes-list');
                if (versoesDropdownList && opcoesValidas.length > 0) {
                    versoesDropdownList.innerHTML = ''; // Limpa qualquer conteúdo prévio
                    // Pega os textos das opções do select principal para usar no dropdown
                    const opcoesTexto = {};
                     if (seletorVersao) {
                          Array.from(seletorVersao.options).forEach(opt => {
                               opcoesTexto[opt.value] = opt.textContent;
                          });
                     }

                    opcoesValidas.forEach(versao => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = `versoes.html?version=${versao}`; // Link para recarregar esta página
                        a.textContent = opcoesTexto[versao] || versao.toUpperCase(); // Usa texto do select ou o código em maiúsculas
                        li.appendChild(a);
                        versoesDropdownList.appendChild(li);
                    });
                } else if (!versoesDropdownList) {
                     console.warn("Elemento <ul id='versoes-list'> não encontrado para popular dropdown de versões.");
                }

            }); // Fim do DOMContentLoaded

        })(); // Fim da IIFE
    </script>
</body>
</html>